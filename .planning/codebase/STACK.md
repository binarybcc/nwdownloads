# Technology Stack

**Analysis Date:** 2026-02-09

## Languages

**Primary:**

- PHP 8.2 - Backend application, API, authentication, data processing
- JavaScript (ES2022) - Frontend interactive features, charts, data visualization
- CSS 3 - Styling via Tailwind CSS

**Secondary:**

- SQL (MySQL/MariaDB dialect) - Database queries and migrations
- HTML 5 - Template markup in PHP files

## Runtime

**Environment:**

- PHP 8.2 (via php:8.2-apache Docker image for development)
- Apache 2.4 - Web server
- Node.js 18+ (for build tooling only, not runtime)

**Package Manager:**

- Composer (PHP) - Version: ^2.0 (manages Phinx migrations)
- npm (JavaScript) - Version: ^16.0 (manages CSS build tools)
- Lockfiles: `composer.lock` present, `package-lock.json` present

## Frameworks

**Core:**

- No framework. Vanilla PHP with custom architecture.
- Modular design with shared functionality in `/web/api/shared/` and `/web/lib/`

**UI/Styling:**

- Tailwind CSS 3.4.0 - Utility-first CSS framework
- Charts.js 4.4.0 - Data visualization (line charts, donut charts)

**Build/Dev:**

- Tailwind CLI 3.4.0 - CSS compilation and minification
- Phinx ^0.13 - Database migrations and schema management
- Husky 9.1.7 - Git hooks for linting/formatting
- ESLint 9.39.2 - JavaScript linting
- Prettier 3.7.4 - Code formatting (JavaScript, JSON, Markdown)
- Commitlint 20.2.0 - Git commit message validation
- Lint-staged 16.2.7 - Pre-commit linting

## Key Dependencies

**Critical:**

- robmorgan/phinx ^0.13 - Database migrations (stored in `db/migrations/`)
  - Handles schema versioning and deployment consistency

**Data Import/Processing:**

- CSV parsing: Built-in PHP functions (fgetcsv, str_getcsv)
- XML parsing: SimpleXMLElement (Newzware auth responses)
- Date handling: DateTime class (PHP standard)

**Infrastructure:**

- PDO (PHP Data Objects) - Database abstraction layer with prepared statements
- cURL - HTTP requests to Newzware authentication API
- Native PHP sessions - Session management with security hardening

## Configuration

**Environment:**

- `.env` file pattern (framework convention, not auto-loaded)
- Environment variables set via Docker-compose and shell scripts
- `.envrc` - direnv integration for automatic `PROJECT_ROOT` setup across workstations

**Build:**

- `tailwind.config.js` - Tailwind CSS configuration
- `.eslintrc.json` - ESLint rules (ES2022, browser + Node.js environment)
- `.prettierrc` - Prettier formatting (100 char line width, single quotes)
- `package.json` - NPM scripts for CSS build, linting, formatting, releases
- `composer.json` - Phinx dependency management
- `phinx.php` - Database migration configuration
- `.husky/` - Pre-commit hooks for code quality

**Key Build Scripts:**

```bash
npm run build:css        # Compile and minify Tailwind CSS
npm run watch:css        # Watch mode for CSS development
npm run lint             # Lint JavaScript files
npm run lint:fix         # Auto-fix linting issues
npm run format           # Format code with Prettier
npm run release          # Automated semantic versioning with standard-version
```

## Platform Requirements

**Development:**

- Docker & Docker Compose (OrbStack on macOS)
- PHP 8.2 (in container)
- MariaDB 10.11 (in container)
- Node.js 18+ (on host, for build tools)
- Git (version control and deployment)

**Production:**

- Native Synology NAS (no Docker)
- Synology Web Station with PHP 8.2 support
- MariaDB 10 (native, via Unix socket at `/run/mysqld/mysqld10.sock`)
- Apache 2.x (Synology native)
- File serving from `/volume1/web/circulation/`

## Version Information

**Current Version:** 2.1.1 (from `package.json`)

**Versioning Strategy:**

- Semantic versioning: MAJOR.MINOR.PATCH
- `package.json` tracks official version (main source of truth)
- `CHANGELOG.md` auto-generated by standard-version from conventional commits
- Automated releases via `npm run release` based on commit history
- Git tags created automatically: `vX.Y.Z`

**Build Tracking:**

- `web/.build_number` - Incremental build counter for deployment tracking
- Build number incremented on each production deployment (separate from semantic version)

## External CDN Libraries

**JavaScript (loaded from CDN in `web/index.php`):**

- Chart.js 4.4.0 via jsDelivr (`cdn.jsdelivr.net`)
  - Purpose: Data visualization (trend charts, delivery distribution)
- Flatpickr (latest) via jsDelivr
  - Purpose: Date picker UI component
- XLSX (SheetJS latest) via cdn.sheetjs.com
  - Purpose: Excel export functionality
- jsPDF 2.5.1 via cdnjs.cloudflare.com
  - Purpose: PDF export functionality
- html2canvas 1.4.1 via cdnjs.cloudflare.com
  - Purpose: HTML-to-image conversion for PDF generation

**Fonts:**

- Inter (300-700 weights) via Google Fonts API
  - Purpose: Primary typeface for dashboard UI

## Database

**Type:** MariaDB 10 (MySQL-compatible)

**Development:** Containerized MariaDB 10.11

- Connection: TCP via hostname `database` (Docker DNS)
- Credentials: From `.env` file (DB_USER, DB_PASSWORD)
- Database: `circulation_dashboard`

**Production:** Native Synology MariaDB 10

- Connection: Unix socket at `/run/mysqld/mysqld10.sock`
- Credentials: Hardcoded in deployment scripts (root user)
- Database: `circulation_dashboard`

**Key Tables:**

- `daily_snapshots` - Core metrics by paper/date (snapshot_date, paper_code)
- `subscriber_snapshots` - Detailed subscriber records
- `raw_uploads` - Source CSV data for audit trail
- `file_processing_log` - Upload processing history
- `phinxlog` - Migration tracking

## Security Configuration

**Session Security (from `web/config.php`):**

- HTTPOnly cookies (prevents JavaScript access)
- SameSite=Strict (CSRF protection)
- Secure flag enabled in production (HTTPS only)
- Session ID regeneration on login
- Session timeout: 2 hours

**Authentication:**

- Newzware API integration via HTTPS/cURL
- XML-based auth responses with usertype validation
- Brute force protection in `web/brute_force_protection.php`
- CSRF token validation in forms

**Database:**

- PDO with prepared statements (SQL injection prevention)
- Error mode set to EXCEPTIONS
- Emulated prepares disabled (uses native driver)

---

_Stack analysis: 2026-02-09_
